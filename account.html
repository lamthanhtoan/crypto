<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Th√¥ng tin t√†i kho·∫£n</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .copy-icon {
      font-size: 1.25rem; /* ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc icon */
      line-height: 1;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 font-inter min-h-screen">
  <div class="absolute top-4 left-4">
    <a href="index.html" class="bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition">Trang Ch·ªß</a>
  </div>
  <div class="max-w-md mx-auto p-4 sm:p-6 pt-16"> <!-- Th√™m padding-top ƒë·ªÉ tr√°nh ch·ªìng l·∫•p n√∫t Trang Ch·ªß -->
    <div class="text-center mb-6">
      <h2 class="text-2xl font-semibold text-blue-400 mb-4">Th√¥ng tin t√†i kho·∫£n</h2>
      <div class="mb-6">
        <img id="account-avatar" src="https://via.placeholder.com/128" alt="Avatar" class="w-32 h-32 rounded-full mx-auto mb-4">
        <input type="file" id="avatar-upload" accept="image/*" class="hidden" onchange="updateAvatar(event)">
        <button id="change-avatar-btn" onclick="document.getElementById('avatar-upload').click()" class="bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition">Thay ƒë·ªïi Avatar</button>
      </div>
    </div>
    <div class="space-y-4">
      <div>
        <label class="block text-sm text-gray-400">T√™n ƒëƒÉng nh·∫≠p</label>
        <p id="account-username" class="w-full bg-gray-700 text-gray-100 border border-gray-600 rounded-md p-2"></p>
      </div>
      <div>
        <label class="block text-sm text-gray-400">T√™n ng∆∞·ªùi d√πng</label>
        <p id="account-fullname" class="w-full bg-gray-700 text-gray-100 border border-gray-600 rounded-md p-2"></p>
      </div>
      <div>
        <label class="block text-sm text-gray-400">Email</label>
        <p id="account-email" class="w-full bg-gray-700 text-gray-100 border border-gray-600 rounded-md p-2"></p>
      </div>
      <div>
        <label class="block text-sm text-gray-400">M√£ gi·ªõi thi·ªáu</label>
        <div class="flex items-center">
          <p id="account-referral" class="w-full bg-gray-700 text-gray-100 border border-gray-600 rounded-md p-2"></p>
          <button onclick="copyReferralCode()" class="ml-2 bg-blue-500 text-white py-1 px-3 rounded-md hover:bg-blue-600 transition"><span class="copy-icon">üìã</span></button>
        </div>
        <div class="flex items-center mt-1">
          <p class="text-gray-500 text-base">L∆∞·ª£t gi·ªõi thi·ªáu: <span id="referral-count">0</span></p>
          <button onclick="showReferralStatsModal()" class="ml-2 text-blue-400 text-base hover:text-blue-300">Xem th√™m</button>
        </div>
      </div>
      <div>
        <label class="block text-sm text-gray-400">M·∫≠t kh·∫©u</label>
        <div class="flex items-center">
          <p id="account-password" class="w-full bg-gray-700 text-gray-100 border border-gray-600 rounded-md p-2">*****</p>
        </div>
        <div class="mt-1">
          <button onclick="showChangePasswordModal()" class="text-blue-400 text-base hover:text-blue-300">Thay ƒë·ªïi m·∫≠t kh·∫©u</button>
        </div>
      </div>
    </div>

    <!-- Modal ƒë·ªïi m·∫≠t kh·∫©u -->
    <div id="change-password-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden flex items-center justify-center">
      <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
        <h3 class="text-lg font-semibold text-blue-400 mb-4">ƒê·ªïi m·∫≠t kh·∫©u</h3>
        <form id="change-password-form" onsubmit="changePassword(event)" class="space-y-4">
          <div>
            <label class="block text-sm text-gray-400">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
            <input id="current-password" type="password" class="w-full bg-gray-700 text-gray-100 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
          </div>
          <div>
            <label class="block text-sm text-gray-400">M·∫≠t kh·∫©u m·ªõi</label>
            <input id="new-password" type="password" class="w-full bg-gray-700 text-gray-100 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10" required>
            <button type="button" id="toggle-new-password" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-200" onclick="togglePasswordVisibility('new-password')">üëÅÔ∏è</button>
          </div>
          <div>
            <label class="block text-sm text-gray-400">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
            <input id="confirm-new-password" type="password" class="w-full bg-gray-700 text-gray-100 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10" required>
            <button type="button" id="toggle-confirm-new-password" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-200" onclick="togglePasswordVisibility('confirm-new-password')">üëÅÔ∏è</button>
          </div>
          <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 transition">L∆∞u thay ƒë·ªïi</button>
          <button type="button" onclick="hideChangePasswordModal()" class="w-full mt-2 bg-gray-600 text-white py-2 rounded-md hover:bg-gray-700 transition">H·ªßy</button>
        </form>
      </div>
    </div>

    <!-- Modal xem l∆∞·ª£t gi·ªõi thi·ªáu -->
    <div id="referral-stats-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden flex items-center justify-center">
      <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
        <h3 class="text-lg font-semibold text-blue-400 mb-4">L∆∞·ª£t gi·ªõi thi·ªáu</h3>
        <p>T·ªïng s·ªë l∆∞·ª£t: <span id="referral-total-count">0</span></p>
        <ul id="referral-list" class="mt-4 space-y-2 text-sm"></ul>
        <button type="button" onclick="hideReferralStatsModal()" class="w-full mt-4 bg-gray-600 text-white py-2 rounded-md hover:bg-gray-700 transition">ƒê√≥ng</button>
      </div>
    </div>

    <!-- Modal ƒë·ªïi m√£ gi·ªõi thi·ªáu -->
    <div id="change-referral-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden flex items-center justify-center">
      <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
        <h3 class="text-lg font-semibold text-blue-400 mb-4">ƒê·ªïi m√£ gi·ªõi thi·ªáu</h3>
        <form id="change-referral-form" onsubmit="changeReferralCode(event)" class="space-y-4">
          <div>
            <label class="block text-sm text-gray-400">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
            <input id="current-password-referral" type="password" class="w-full bg-gray-700 text-gray-100 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
          </div>
          <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 transition">T·∫°o m√£ m·ªõi</button>
          <button type="button" onclick="hideChangeReferralModal()" class="w-full mt-2 bg-gray-600 text-white py-2 rounded-md hover:bg-gray-700 transition">H·ªßy</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    function loadAccountInfo() {
      const username = localStorage.getItem('currentUser');
      const users = JSON.parse(localStorage.getItem('users') || '{}');
      const user = users[username];
      if (user) {
        document.getElementById('account-username').textContent = username || '12';
        document.getElementById('account-fullname').textContent = user.fullName || 'Nguyen Van B';
        document.getElementById('account-email').textContent = user.email || 'nguyenvanb@example.com';
        document.getElementById('account-referral').textContent = user.ownReferralCode || 'ABC12345';
        document.getElementById('account-password').textContent = '*****';
        document.getElementById('account-avatar').src = user.avatar || 'https://via.placeholder.com/128';
        updateReferralStats();
      } else if (!username) {
        window.location.href = 'index.html';
      }
    }

    function updateAvatar(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const username = localStorage.getItem('currentUser');
          const users = JSON.parse(localStorage.getItem('users') || '{}');
          if (users[username]) {
            users[username].avatar = e.target.result;
            localStorage.setItem('users', JSON.stringify(users));
            document.getElementById('account-avatar').src = e.target.result;
          }
        };
        reader.readAsDataURL(file);
      }
    }

    function togglePasswordVisibility(inputId) {
      const passwordInput = document.getElementById(inputId);
      const toggleButton = document.getElementById(`toggle-${inputId}`);
      if (passwordInput && toggleButton) {
        const type = passwordInput.type === 'password' ? 'text' : 'password';
        passwordInput.type = type;
        toggleButton.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è';
      }
    }

    function showChangePasswordModal() {
      document.getElementById('change-password-modal').classList.remove('hidden');
    }

    function hideChangePasswordModal() {
      document.getElementById('change-password-modal').classList.add('hidden');
      document.getElementById('change-password-form').reset();
    }

    function showChangeReferralModal() {
      document.getElementById('change-referral-modal').classList.remove('hidden');
    }

    function hideChangeReferralModal() {
      document.getElementById('change-referral-modal').classList.add('hidden');
      document.getElementById('change-referral-form').reset();
    }

    function showReferralStatsModal() {
      document.getElementById('referral-stats-modal').classList.remove('hidden');
      updateReferralStats();
    }

    function hideReferralStatsModal() {
      document.getElementById('referral-stats-modal').classList.add('hidden');
    }

    function changePassword(event) {
      event.preventDefault();
      const currentPassword = document.getElementById('current-password').value.trim();
      const newPassword = document.getElementById('new-password').value.trim();
      const confirmNewPassword = document.getElementById('confirm-new-password').value.trim();

      if (!currentPassword || !newPassword || !confirmNewPassword) {
        alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
        return;
      }
      if (newPassword !== confirmNewPassword) {
        alert('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');
        return;
      }

      const username = localStorage.getItem('currentUser');
      const users = JSON.parse(localStorage.getItem('users') || '{}');
      if (users[username] && users[username].password === currentPassword) {
        users[username].password = newPassword;
        localStorage.setItem('users', JSON.stringify(users));
        hideChangePasswordModal();
        alert('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!');
      } else {
        alert('M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng!');
      }
    }

    function changeReferralCode(event) {
      event.preventDefault();
      const currentPassword = document.getElementById('current-password-referral').value.trim();

      if (!currentPassword) {
        alert('Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i!');
        return;
      }

      const username = localStorage.getItem('currentUser');
      const users = JSON.parse(localStorage.getItem('users') || '{}');
      if (users[username] && users[username].password === currentPassword) {
        const newReferralCode = generateReferralCode();
        users[username].ownReferralCode = newReferralCode;
        localStorage.setItem('users', JSON.stringify(users));
        document.getElementById('account-referral').textContent = newReferralCode;
        hideChangeReferralModal();
        alert(`ƒê√£ t·∫°o m√£ gi·ªõi thi·ªáu m·ªõi: ${newReferralCode}`);
      } else {
        alert('M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng!');
      }
    }

    function generateReferralCode() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let code = '';
      for (let i = 0; i < 8; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return code;
    }

    function copyReferralCode() {
      const referralCode = document.getElementById('account-referral').textContent;
      if (referralCode && referralCode !== '*****') {
        navigator.clipboard.writeText(referralCode).then(() => {
          alert('ƒê√£ sao ch√©p m√£ gi·ªõi thi·ªáu!');
        }).catch(err => {
          alert('Kh√¥ng th·ªÉ sao ch√©p m√£ gi·ªõi thi·ªáu!');
          console.error('L·ªói sao ch√©p:', err);
        });
      }
    }

    function updateReferralStats() {
      const users = JSON.parse(localStorage.getItem('users') || '{}');
      const currentUser = localStorage.getItem('currentUser');
      let count = 0;
      const referrals = [];

      for (let user in users) {
        if (users[user].referralCode && users[user].referralCode === users[currentUser]?.ownReferralCode) {
          count++;
          referrals.push({
            username: user,
            created: users[user].created || new Date().toLocaleString('vi-VN')
          });
        }
      }

      document.getElementById('referral-count').textContent = count;
      document.getElementById('referral-total-count').textContent = count;
      const referralList = document.getElementById('referral-list');
      referralList.innerHTML = referrals.map(ref => `<li>${ref.username} - ƒê√£ t·∫°o: ${ref.created}</li>`).join('');
    }

    document.addEventListener('DOMContentLoaded', loadAccountInfo);
  </script>
</body>
</html>
